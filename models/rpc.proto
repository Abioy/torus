syntax = "proto3";

import "github.com/gogo/protobuf/gogoproto/gogo.proto";
import "agro.proto";

package models;

service AgroStorage {
	rpc Block (BlockRequest) returns (BlockResponse);
	rpc INode (INodeRequest) returns (INodeResponse);
	rpc PutBlock (PutBlockRequest) returns (PutResponse);
	rpc PutINode (PutINodeRequest) returns (PutResponse);
  rpc RebalanceMessage (RebalanceRequest) returns (RebalanceResponse);
}

message Block {
	bool ok = 1;
	bytes data = 2;
}

message BlockRequest {
	repeated BlockRef block_refs = 1;
}

message BlockResponse {
	repeated Block blocks = 1;
}

message INodeRequest {
	repeated INodeRef inoderefs = 1 [(gogoproto.customname) = "INodeRefs"];
}

message INodeResponse {
	repeated INode inodes = 2 [(gogoproto.customname) = "INodes"];
}

message PutBlockRequest {
	repeated BlockRef refs = 1;
	repeated bytes blocks = 2;
}

message PutINodeRequest {
	repeated INodeRef refs = 1;
	repeated INode inodes = 2 [(gogoproto.customname) = "INodes"];
}

message PutResponse {
	bool ok = 1;
	string err = 2;
}

message RebalanceRequest {
  oneof subrequest {
    BlockRequest block_request = 1;
    PutBlockRequest put_block_request = 2;
    INodeRequest inode_request = 3 [(gogoproto.customname) = "INodeRequest"];
    PutINodeRequest put_inode_request = 4 [(gogoproto.customname) = "PutINodeRequest"];
  }
  int32 phase = 5;
  string uuid = 6 [(gogoproto.customname) = "UUID"];
  bytes rebalance_data = 7;
}

message RebalanceResponse {
  bool ok = 1;
  string err = 2;
  oneof subresponse {
    BlockResponse block_response = 3;
    INodeResponse inode_response = 4 [(gogoproto.customname) = "INodeRepsonse"];
  }
  int32 phase = 5;
  string uuid = 6 [(gogoproto.customname) = "UUID"];
  bytes rebalance_data = 7;
}
